# 🧩 SOP: Terraform EC2 Instance + State File + Outputs 💻☁️
🎯 Goal

 By the end of this SOP, you’ll:
✅ Create a simple EC2 instance using Terraform
✅ Understand Terraform state file (terraform.tfstate)
✅ Use outputs to get instance ID and public IP

🪜 Step-by-Step Guide
## 🥇 Step 1: Authenticate AWS 🔐

Use environment variables or AWS CLI configure:

Option 1: Environment Variables
export AWS_ACCESS_KEY_ID="your_access_key"
export AWS_SECRET_ACCESS_KEY="your_secret_key"
export AWS_DEFAULT_REGION="ap-south-1"


✅ Verify:

echo $AWS_ACCESS_KEY_ID
echo $AWS_SECRET_ACCESS_KEY
echo $AWS_DEFAULT_REGION

## Option 2: AWS CLI Configure
aws configure


Enter:

AWS Access Key ID [None]: your_access_key
AWS Secret Access Key [None]: your_secret_key
Default region name [None]: ap-south-1
Default output format [None]: json


✅ Verify:

aws sts get-caller-identity

# 🥈 Step 2: Create Terraform Project Folder 📁
mkdir terraform-ec2-demo
cd terraform-ec2-demo

# 🥉 Step 3: Create provider.tf 🔑
provider "aws" {
  region = var.aws_region
}

# 🏗️ Step 4: Create variables.tf 🌱
variable "aws_region" {
  description = "AWS Region to deploy EC2"
  default     = "ap-south-1"
}

# 🖥️ Step 5: Create EC2 Instance ec2.tf ⚡
resource "aws_instance" "demo_instance" {
  ami           = "ami-0dee22c13ea7a9a67"  # Ubuntu 22.04 (Mumbai)
  instance_type = "t2.micro"
  key_name      = "my-keypair"              # Replace with your keypair

  tags = {
    Name = "Terraform-EC2-Demo"
  }
}

# Output the instance ID
output "instance_id" {
  description = "The ID of the EC2 instance"
  value       = aws_instance.demo_instance.id
}

# Output the public IP
output "public_ip" {
  description = "The public IP of the EC2 instance"
  value       = aws_instance.demo_instance.public_ip
}


💡 Use Case:
You’ll get the EC2 instance ID and public IP printed after terraform apply.

# ⚙️ Step 6: Initialize Terraform 🧠
terraform init

# 🔍 Step 7: Plan Deployment 📝
terraform plan

# 🚀 Step 8: Apply Configuration 🖥️
terraform apply -auto-approve


✅ Output example:

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.

Outputs:

instance_id = "i-0abc123456def"
public_ip   = "3.22.45.67"


✅ Understand what the Terraform state file is
✅ Learn why it’s important
✅ Inspect and read state safely
✅ Use outputs to get info about your resources

---

## 🪜 **Step-by-Step Guide**

---

### 🥇 Step 9: Output Values (`terraform output`) 🖥️

Before diving into state:

```bash
terraform output
```

✅ Prints all outputs defined in your `.tf` files
💡 Example: EC2 `public_ip`, `instance_id`, etc.

**Use Case:**
Quickly fetch resource info without logging into the AWS Console.

---

### 🥈 Step 9: What is the Terraform State File? 🧠

* **File Name:** `terraform.tfstate`
* **Purpose:** Tracks the **current state** of all infrastructure resources deployed by Terraform
* **Location:** Automatically created in your Terraform project folder

💡 **Use Case:**
Terraform uses this file to **know what exists in AWS** (or any provider). Without it, Terraform can’t tell which resources are new, updated, or deleted.

---

### 🥉 Step 10: Why is it Important? ⚡

| Feature                    | Description                               | DevOps Use Case                                    |
| -------------------------- | ----------------------------------------- | -------------------------------------------------- |
| Tracks real infrastructure | Keeps a record of all deployed resources  | Ensures Terraform knows what exists in AWS         |
| Syncs code & cloud         | Matches `.tf` files with actual resources | Avoids accidental resource duplication or deletion |
| Team collaboration         | Can be stored remotely later              | Multiple people can work on the same infra safely  |
| Automation safety          | Detects changes before applying           | Prevents overwriting or breaking resources         |

---

### 🏗️ Step 11: Inspect the State File 🔍

```bash
terraform show
```

✅ Shows the detailed current state of your infrastructure resources.

```bash
cat terraform.tfstate
```

💡 **Tip:** It’s JSON-formatted. **Do not edit manually** — Terraform may break.

---

### ⚙️ Step 13: Use Outputs from State 🔑

```bash
terraform output
```

* Displays all outputs defined in `.tf` files
* Example outputs:

  * `EC2 public_ip = "3.22.45.67"`
  * `instance_id = "i-0abc123456def"`

💡 **Use Case:** Quickly see EC2 instance IP or ID without logging into AWS Console.

---

### 💣 Step 14: Destroy & State Update 🧹

When you destroy resources:

```bash
terraform destroy -auto-approve
```

✅ Terraform updates the state file automatically — resources are removed from state.

💡 **Tip:** Always **backup `terraform.tfstate`** before making major changes.

---

### ⚡ Summary Table

| Step | Action            | Command / File           | Result / Use Case                          |
| ---- | ----------------- | ------------------------ | ------------------------------------------ |
| 🥇   | Output Values     | `terraform output`       | Get info about resources quickly           |
| 🥈   | Inspect State     | `terraform show`         | View current infra resources               |
| 🥉   | Read File         | `cat terraform.tfstate`  | Understand infra in JSON                   |
| ⚙️   | Destroy Resources | `terraform destroy`      | Updates state file to reflect infra status |
| 💣   | Backup State      | Copy `terraform.tfstate` | Prevent accidental loss or corruption      |

---

⚠️ **Notes / Best Practices:**

* Never manually edit `terraform.tfstate`
* Always **backup state file** before destructive changes
* Outputs are **critical for automation** and linking resources

---

✅ **Next SOP:** **SOP for Remote State (S3, GCS, Terraform Cloud)** — advanced team collaboration and state locking.
