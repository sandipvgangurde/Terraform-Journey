# ğŸ§© **SOP: Terraform Provisioners â€” Automate Configuration Inside Resources** âš™ï¸ğŸ–¥ï¸

---

## ğŸ¯ **Goal**

By the end of this SOP, youâ€™ll:
âœ… Understand what Terraform **provisioners** are
âœ… Use `remote-exec` and `file` provisioners with **AWS EC2**
âœ… Automate post-deployment setup (like installing Nginx, copying files, etc.)
âœ… Learn **best practices** for safe and reliable automation

---

## ğŸ§  **What Are Provisioners?**

Provisioners are Terraformâ€™s way of **running scripts or commands inside your resources** after they are created.

Think of them like:

> â€œHey Terraform, after you create this EC2 instance, run these commands to configure it.â€

---

## âš™ï¸ **Types of Provisioners**

| ğŸ”¢  | Provisioner Type  | Description                                           | Example Use Case                       |
| --- | ----------------- | ----------------------------------------------------- | -------------------------------------- |
| 1ï¸âƒ£ | **`remote-exec`** | Runs commands over SSH on the remote VM               | Install Nginx, start services          |
| 2ï¸âƒ£ | **`file`**        | Copies files from local machine to remote instance    | Upload configuration files             |
| 3ï¸âƒ£ | **`local-exec`**  | Runs command locally (on your machine) after creation | Notify Slack, trigger Ansible playbook |

---

## ğŸªœ **Step-by-Step: Using Provisioners in Terraform**

---

### ğŸ¥‡ Step 1: Setup Folder ğŸ“

```bash
mkdir terraform-provisioner-demo
cd terraform-provisioner-demo
```

---

### ğŸ¥ˆ Step 2: Create `provider.tf` â˜ï¸

```hcl
provider "aws" {
  region = "ap-south-1"
}
```

---

### ğŸ¥‰ Step 3: Create EC2 Instance with Provisioner `ec2.tf` ğŸ–¥ï¸

```hcl
resource "aws_instance" "web" {
  ami           = "ami-0dee22c13ea7a9a67"   # Ubuntu 22.04 (Mumbai)
  instance_type = "t2.micro"
  key_name      = "my-keypair"


  # Run remote commands (install Nginx)
  provisioner "remote-exec" {
    inline = [
      "sudo apt update -y",
      "sudo apt install nginx -y",
      "sudo systemctl start nginx",
      "sudo systemctl enable nginx"
    ]
  }

  connection {
    type        = "ssh"
    user        = "ubuntu"
    private_key = file("~/.ssh/my-keypair.pem")
    host        = self.public_ip
  }

  tags = {
    Name = "Terraform-Provisioner-Demo"
  }
}
```

---

### ğŸ—ï¸ Step 4: Initialize, Plan & Apply Terraform ğŸ’¥

```bash
terraform init
terraform plan
terraform apply -auto-approve
```

âœ… Terraform will:

1. Create EC2
2. Copy your `index.html` file
3. Install and start Nginx inside the instance

---

### ğŸ” Step 5: Verify in AWS Console ğŸŒ

* Go to **EC2 â†’ Instances**
* Copy the **Public IPv4 address**
* Open in browser:
  ğŸ‘‰ `http://<your-public-ip>`

Youâ€™ll see:
**â€œWelcome to Terraform Provisioner Demo ğŸš€â€**

---

### ğŸ§© Step 7: Add Outputs (Optional but Recommended)

```hcl
output "ec2_public_ip" {
  value = aws_instance.web.public_ip
}

output "instance_id" {
  value = aws_instance.web.id
}
```

âœ… Run:

```bash
terraform output
```

ğŸ“¦ Output example:

```
ec2_public_ip = "3.110.22.45"
instance_id   = "i-0ab1234def5678gh"
```

---

### ğŸ’£ Step 8: Destroy Resources After Testing ğŸ§¹

```bash
terraform destroy -auto-approve
```

âœ… Cleans up instance and all related state.

---

## ğŸ” **Best Practices (DevOps-Level)**

| âš™ï¸ Practice                            | ğŸ’¡ Explanation                                                         |
| -------------------------------------- | ---------------------------------------------------------------------- |
| Avoid heavy use of provisioners        | Use configuration management tools like **Ansible** for complex setups |
| Always use `connection` block securely | Store keys in a safe place, never hardcode them                        |
| Use `local-exec` for pipeline triggers | For CI/CD notifications or Ansible triggers                            |
| Keep scripts idempotent                | Ensure re-runs donâ€™t break your infra                                  |
| Log provisioner actions                | Add output redirection for better debugging                            |

---

## ğŸ§¾ **Summary Table**

| Step | File / Command    | Description        | Result                      |
| ---- | ----------------- | ------------------ | --------------------------- |
| ğŸ¥‡   | `provider.tf`     | AWS provider setup | Defines cloud provider      |
| ğŸ¥‰   | `ec2.tf`          | EC2 + provisioners | Deploys & configures VM     |
| âš™ï¸   | `terraform apply` | Execute            | Runs provisioning steps     |
| ğŸ”   | Browser check     | Verify             | Access webpage on public IP |

---

## ğŸ’¡ **Real-World DevOps Use Case**

In production:

* Use **provisioners** for quick, single-run setups (e.g., temporary scripts).
* For full automation â†’ integrate **Terraform + Ansible + Jenkins** combo.

---

## ğŸš€ **End Result**

âœ… EC2 instance is created
âœ… Nginx auto-installed
âœ… Webpage served immediately
âœ… Infrastructure fully automated ğŸ¯

---
