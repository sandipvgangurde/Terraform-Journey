# 🧩 **SOP: Terraform + AWS EC2 Setup (Secure Auth & AWS CLI Management)** 💻☁️

---

## 🎯 **Goal**

By the end of this SOP, you’ll:

✅ Authenticate AWS using **environment variables** or **AWS CLI configure**
✅ Create **one EC2 instance** using Terraform
✅ Learn best practices — **no hardcoding credentials**
✅ Manage or remove AWS CLI configurations safely

---

## 🪜 **Step-by-Step Guide**

---

### 🥇 Step 1: Authenticate AWS 🔐

#### **Option 1: Using Environment Variables**

```bash
export AWS_ACCESS_KEY_ID="your_access_key"
export AWS_SECRET_ACCESS_KEY="your_secret_key"
export AWS_DEFAULT_REGION="ap-south-1"
```

✅ **Verify:**

```bash
echo $AWS_ACCESS_KEY_ID
echo $AWS_SECRET_ACCESS_KEY
echo $AWS_DEFAULT_REGION
```

💡 **Use Case:**
Terraform reads these automatically. Safer than putting keys in code.

---

#### **Option 2: Using AWS CLI Configure**

```bash
aws configure
```

Then input:

```
AWS Access Key ID [None]: your_access_key
AWS Secret Access Key [None]: your_secret_key
Default region name [None]: ap-south-1
Default output format [None]: json
```

✅ **Verify:**

```bash
aws sts get-caller-identity
```

> Output shows your AWS account ID and ARN — confirms authentication works.

💡 **Use Case:** Terraform picks credentials from `~/.aws/credentials`. Common in DevOps workflows.

---

### 🥈 Step 2: Create Terraform Project Folder 📁

```bash
mkdir terraform-ec2-simple
cd terraform-ec2-simple
```

💡 **Use Case:** Keeps Terraform workspace organized.

---

### 🥉 Step 3: Create `provider.tf` 🔑

```hcl
provider "aws" {
  region = var.aws_region
}
```

💡 Terraform automatically uses environment variables **or** AWS CLI config.

---

### 🏗️ Step 4: Create `variables.tf` 🌱

```hcl
variable "aws_region" {
  description = "AWS Region to deploy EC2"
  default     = "us-east-1"
}
```

💡 **Use Case:** Centralizes region configuration.

---

### 🖥️ Step 5: Create EC2 Instance `ec2.tf` ⚡

```hcl
resource "aws_instance" "myec2" {
    ami="ami-0341d95f75f311023"
    instance_type="t3.micro"
}
output "instance_id" {
  value = aws_instance.myec2.id
}

output "public_ip" {
  value = aws_instance.myec2.public_ip
}
```

💡 **Use Case:** Deploys one EC2 instance automatically and shows **Instance ID & Public IP**.

---

### ⚙️ Step 6: Initialize Terraform 🧠

```bash
terraform init
```

✅ Downloads AWS provider and prepares Terraform.

---

### 🔍 Step 7: Plan Deployment 📝

```bash
terraform plan
```

✅ Preview changes before applying.

---

### 🚀 Step 8: Apply Configuration 🖥️

```bash
terraform apply -auto-approve
```

✅ Creates EC2 instance automatically in AWS account.

---

### 👀 Step 9: Verify in AWS Console 🔎

* Go to **EC2 → Instances**
* Check instance named **Terraform-EC2-Simple**

---

### 💣 Step 10: Destroy Resources When Done 🧹

```bash
terraform destroy -auto-approve
```

✅ Cleans up AWS to avoid charges 💰

---

### 🗑️ Step 11: Remove or Manage AWS CLI Config (Linux) 🧹

#### 1️⃣ Default CLI config location

* **Linux/macOS:** `~/.aws/`
* **Windows:** `C:\Users\<username>\.aws\`

Contains:

* `credentials` → stores Access Key & Secret Key
* `config` → stores default region and output format

---

#### 2️⃣ Remove all CLI configs

```bash
rm -rf ~/.aws
```

> Completely removes all saved profiles, keys, and default region/output.

---

#### 3️⃣ Remove a specific profile (optional)

```bash
nano ~/.aws/credentials
nano ~/.aws/config
```

Delete only the profile you want to remove.

---

#### 4️⃣ Remove via CLI

```bash
aws configure
# Press Enter for each prompt to leave blank
```

> This unsets default credentials safely.

⚠️ **Warning:** Deleting `.aws` will break scripts or CLI commands depending on AWS credentials.

---

## 🧩 **Summary Table**

| Step | Action                | Command / File                    | Result / Use Case                         |
| ---- | --------------------- | --------------------------------- | ----------------------------------------- |
| 🥇   | AWS Auth              | Env variables / `aws configure`   | Secure authentication                     |
| 🥈   | Project Folder        | `mkdir terraform-ec2-simple`      | Workspace ready                           |
| 🥉   | Provider              | `provider.tf`                     | Terraform picks credentials automatically |
| 🏗️  | Variables             | `variables.tf`                    | Centralized region config                 |
| 🖥️  | EC2 Instance + Output | `ec2.tf`                          | Single EC2 deployed with outputs          |
| ⚙️   | Init                  | `terraform init`                  | Terraform ready                           |
| 🔍   | Plan                  | `terraform plan`                  | Preview deployment                        |
| 🚀   | Apply                 | `terraform apply`                 | EC2 created                               |
| 👀   | Verify                | AWS Console                       | Confirm deployment                        |
| 💣   | Destroy               | `terraform destroy`               | Cleanup AWS                               |
| 🗑️  | Remove CLI config     | `rm -rf ~/.aws` / `aws configure` | Remove or reset credentials safely        |

---

⚡ **Notes & Tips:**

* **Do not hardcode keys** — environment variables or CLI config are best practice.
* Outputs let you **reuse instance info** in scripts.
* Always destroy resources to **avoid unwanted charges**.

---

