# ğŸ§  SOP: Terraform `local-exec` Provisioner ğŸ’»

### ğŸ¯ **Goal**

Run **local system commands (on your own computer)** automatically **after Terraform creates a resource** â€” for example, saving the EC2 instanceâ€™s private IP into a file.

---

## ğŸªœ Step-by-Step Guide

### ğŸ§© Step 1: Prerequisites

Before you begin:

* âœ… Terraform is installed (`terraform -v`)
* âœ… AWS credentials are configured (`aws configure`)
* âœ… Youâ€™ve set your desired region in the provider block

---

### âš™ï¸ Step 2: Terraform Configuration File

#### ğŸ“ File: `main.tf`

```hcl
provider "aws" {
  region = "ap-south-1"
}

# ğŸ–¥ï¸ Create EC2 instance
resource "aws_instance" "myec2" {
  ami           = "ami-082b5a644766e0e6f" # âœ… Amazon Linux 2 AMI (Mumbai)
  instance_type = "t2.micro"

  # ğŸ’» Run a local command on your system
  provisioner "local-exec" {
    command = "echo ${aws_instance.myec2.private_ip} >> private_ips.txt"
  }
}

# ğŸ“¤ Output for visibility
output "private_ip" {
  value = aws_instance.myec2.private_ip
}
```

---

### ğŸ§  Step 3: How It Works

| ğŸ”¢ Concept                         | ğŸ’¬ Description                                         | ğŸ§° Use Case                                |
| ---------------------------------- | ------------------------------------------------------ | ------------------------------------------ |
| `provisioner "local-exec"`         | Executes commands **on the machine running Terraform** | Logging, triggering scripts, notifications |
| `command`                          | Shell command to execute                               | Can run `bash`, `echo`, `python`, etc.     |
| `${aws_instance.myec2.private_ip}` | Interpolates Terraform variable values                 | Fetches EC2 private IP dynamically         |
| `>> private_ips.txt`               | Appends IP to a file on your local system              | Creates a running log of new instance IPs  |

---

### âš¡ Step 4: Initialize & Apply

```bash
terraform init
terraform plan
terraform apply -auto-approve
```

âœ… Terraform will:

1. Create an EC2 instance in AWS
2. Capture its private IP
3. Run your **local command** on your computer
4. Write the private IP into a file named `private_ips.txt`

---

### ğŸ§¾ Step 5: Verify the Result

Check your local file:

```bash
cat private_ips.txt
```

ğŸ“„ **Expected Output:**

```
172.31.22.134
```

(Your EC2â€™s private IP address)

---

## ğŸ’¡ Real-World Use Cases

| âš™ï¸ Task                             | ğŸš€ Benefit                                             |
| ----------------------------------- | ------------------------------------------------------ |
| Save instance info (IP, ID) locally | Easy for manual tracking                               |
| Run post-deploy scripts             | Notify via email or Slack                              |
| Update configuration files          | Auto-write data to `.env` or JSON                      |
| Trigger external tools              | Run Ansible, Jenkins, or CI/CD jobs after infra change |

---

## âš ï¸ Best Practices

âœ… Keep commands **idempotent** â€” safe to re-run.
âš™ï¸ Use **absolute paths** if Terraform runs from CI/CD.
ğŸ” Donâ€™t write sensitive data (like passwords or secrets) into files.
ğŸ§± Use `depends_on` if your local command depends on other resources.

---

## ğŸ§¾ Summary Table

| Step | Action               | Command / Description           |
| ---- | -------------------- | ------------------------------- |
| 1ï¸âƒ£  | Configure AWS        | `aws configure`                 |
| 2ï¸âƒ£  | Initialize Terraform | `terraform init`                |
| 3ï¸âƒ£  | Apply Changes        | `terraform apply -auto-approve` |
| 4ï¸âƒ£  | Save EC2 Private IP  | Appends to `private_ips.txt`    |
| 5ï¸âƒ£  | Verify               | `cat private_ips.txt`           |

---

## ğŸ§© Use Case Demo Flow

ğŸ§± Create EC2 âœ âš¡ Terraform runs local-exec âœ ğŸ’¾ IP saved to file âœ ğŸ“Š Used later for monitoring or deployment.
