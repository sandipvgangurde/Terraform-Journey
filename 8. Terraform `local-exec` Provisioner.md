# 🧠 SOP: Terraform `local-exec` Provisioner 💻

### 🎯 **Goal**

Run **local system commands (on your own computer)** automatically **after Terraform creates a resource** — for example, saving the EC2 instance’s private IP into a file.

---

## 🪜 Step-by-Step Guide

### 🧩 Step 1: Prerequisites

Before you begin:

* ✅ Terraform is installed (`terraform -v`)
* ✅ AWS credentials are configured (`aws configure`)
* ✅ You’ve set your desired region in the provider block

---

### ⚙️ Step 2: Terraform Configuration File

#### 📁 File: `main.tf`

```hcl
provider "aws" {
  region = "ap-south-1"
}

# 🖥️ Create EC2 instance
resource "aws_instance" "myec2" {
  ami           = "ami-082b5a644766e0e6f" # ✅ Amazon Linux 2 AMI (Mumbai)
  instance_type = "t2.micro"

  # 💻 Run a local command on your system
  provisioner "local-exec" {
    command = "echo ${aws_instance.myec2.private_ip} >> private_ips.txt"
  }
}

# 📤 Output for visibility
output "private_ip" {
  value = aws_instance.myec2.private_ip
}
```

---

### 🧠 Step 3: How It Works

| 🔢 Concept                         | 💬 Description                                         | 🧰 Use Case                                |
| ---------------------------------- | ------------------------------------------------------ | ------------------------------------------ |
| `provisioner "local-exec"`         | Executes commands **on the machine running Terraform** | Logging, triggering scripts, notifications |
| `command`                          | Shell command to execute                               | Can run `bash`, `echo`, `python`, etc.     |
| `${aws_instance.myec2.private_ip}` | Interpolates Terraform variable values                 | Fetches EC2 private IP dynamically         |
| `>> private_ips.txt`               | Appends IP to a file on your local system              | Creates a running log of new instance IPs  |

---

### ⚡ Step 4: Initialize & Apply

```bash
terraform init
terraform plan
terraform apply -auto-approve
```

✅ Terraform will:

1. Create an EC2 instance in AWS
2. Capture its private IP
3. Run your **local command** on your computer
4. Write the private IP into a file named `private_ips.txt`

---

### 🧾 Step 5: Verify the Result

Check your local file:

```bash
cat private_ips.txt
```

📄 **Expected Output:**

```
172.31.22.134
```

(Your EC2’s private IP address)

---

## 💡 Real-World Use Cases

| ⚙️ Task                             | 🚀 Benefit                                             |
| ----------------------------------- | ------------------------------------------------------ |
| Save instance info (IP, ID) locally | Easy for manual tracking                               |
| Run post-deploy scripts             | Notify via email or Slack                              |
| Update configuration files          | Auto-write data to `.env` or JSON                      |
| Trigger external tools              | Run Ansible, Jenkins, or CI/CD jobs after infra change |

---

## ⚠️ Best Practices

✅ Keep commands **idempotent** — safe to re-run.
⚙️ Use **absolute paths** if Terraform runs from CI/CD.
🔐 Don’t write sensitive data (like passwords or secrets) into files.
🧱 Use `depends_on` if your local command depends on other resources.

---

## 🧾 Summary Table

| Step | Action               | Command / Description           |
| ---- | -------------------- | ------------------------------- |
| 1️⃣  | Configure AWS        | `aws configure`                 |
| 2️⃣  | Initialize Terraform | `terraform init`                |
| 3️⃣  | Apply Changes        | `terraform apply -auto-approve` |
| 4️⃣  | Save EC2 Private IP  | Appends to `private_ips.txt`    |
| 5️⃣  | Verify               | `cat private_ips.txt`           |

---

## 🧩 Use Case Demo Flow

🧱 Create EC2 ➜ ⚡ Terraform runs local-exec ➜ 💾 IP saved to file ➜ 📊 Used later for monitoring or deployment.
