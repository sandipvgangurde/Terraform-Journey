# ğŸ§© SOP: Terraform EC2 Instance + State File + Outputs ğŸ’»â˜ï¸
ğŸ¯ Goal

 By the end of this SOP, youâ€™ll:
âœ… Create a simple EC2 instance using Terraform
âœ… Understand Terraform state file (terraform.tfstate)
âœ… Use outputs to get instance ID and public IP

ğŸªœ Step-by-Step Guide
## ğŸ¥‡ Step 1: Authenticate AWS ğŸ”

Use environment variables or AWS CLI configure:

Option 1: Environment Variables
export AWS_ACCESS_KEY_ID="your_access_key"
export AWS_SECRET_ACCESS_KEY="your_secret_key"
export AWS_DEFAULT_REGION="ap-south-1"


âœ… Verify:

echo $AWS_ACCESS_KEY_ID
echo $AWS_SECRET_ACCESS_KEY
echo $AWS_DEFAULT_REGION

## Option 2: AWS CLI Configure
aws configure


Enter:

AWS Access Key ID [None]: your_access_key
AWS Secret Access Key [None]: your_secret_key
Default region name [None]: ap-south-1
Default output format [None]: json


âœ… Verify:

aws sts get-caller-identity

# ğŸ¥ˆ Step 2: Create Terraform Project Folder ğŸ“
mkdir terraform-ec2-demo
cd terraform-ec2-demo

# ğŸ¥‰ Step 3: Create provider.tf ğŸ”‘
provider "aws" {
  region = var.aws_region
}

# ğŸ—ï¸ Step 4: Create variables.tf ğŸŒ±
variable "aws_region" {
  description = "AWS Region to deploy EC2"
  default     = "ap-south-1"
}

# ğŸ–¥ï¸ Step 5: Create EC2 Instance ec2.tf âš¡
resource "aws_instance" "demo_instance" {
  ami           = "ami-0dee22c13ea7a9a67"  # Ubuntu 22.04 (Mumbai)
  instance_type = "t2.micro"
  key_name      = "my-keypair"              # Replace with your keypair

  tags = {
    Name = "Terraform-EC2-Demo"
  }
}

# Output the instance ID
output "instance_id" {
  description = "The ID of the EC2 instance"
  value       = aws_instance.demo_instance.id
}

# Output the public IP
output "public_ip" {
  description = "The public IP of the EC2 instance"
  value       = aws_instance.demo_instance.public_ip
}


ğŸ’¡ Use Case:
Youâ€™ll get the EC2 instance ID and public IP printed after terraform apply.

# âš™ï¸ Step 6: Initialize Terraform ğŸ§ 
terraform init

# ğŸ” Step 7: Plan Deployment ğŸ“
terraform plan

# ğŸš€ Step 8: Apply Configuration ğŸ–¥ï¸
terraform apply -auto-approve


âœ… Output example:

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.

Outputs:

instance_id = "i-0abc123456def"
public_ip   = "3.22.45.67"


âœ… Understand what the Terraform state file is
âœ… Learn why itâ€™s important
âœ… Inspect and read state safely
âœ… Use outputs to get info about your resources

---

## ğŸªœ **Step-by-Step Guide**

---

### ğŸ¥‡ Step 9: Output Values (`terraform output`) ğŸ–¥ï¸

Before diving into state:

```bash
terraform output
```

âœ… Prints all outputs defined in your `.tf` files
ğŸ’¡ Example: EC2 `public_ip`, `instance_id`, etc.

**Use Case:**
Quickly fetch resource info without logging into the AWS Console.

---

### ğŸ¥ˆ Step 9: What is the Terraform State File? ğŸ§ 

* **File Name:** `terraform.tfstate`
* **Purpose:** Tracks the **current state** of all infrastructure resources deployed by Terraform
* **Location:** Automatically created in your Terraform project folder

ğŸ’¡ **Use Case:**
Terraform uses this file to **know what exists in AWS** (or any provider). Without it, Terraform canâ€™t tell which resources are new, updated, or deleted.

---

### ğŸ¥‰ Step 10: Why is it Important? âš¡

| Feature                    | Description                               | DevOps Use Case                                    |
| -------------------------- | ----------------------------------------- | -------------------------------------------------- |
| Tracks real infrastructure | Keeps a record of all deployed resources  | Ensures Terraform knows what exists in AWS         |
| Syncs code & cloud         | Matches `.tf` files with actual resources | Avoids accidental resource duplication or deletion |
| Team collaboration         | Can be stored remotely later              | Multiple people can work on the same infra safely  |
| Automation safety          | Detects changes before applying           | Prevents overwriting or breaking resources         |

---

### ğŸ—ï¸ Step 11: Inspect the State File ğŸ”

```bash
terraform show
```

âœ… Shows the detailed current state of your infrastructure resources.

```bash
cat terraform.tfstate
```

ğŸ’¡ **Tip:** Itâ€™s JSON-formatted. **Do not edit manually** â€” Terraform may break.

---

### âš™ï¸ Step 13: Use Outputs from State ğŸ”‘

```bash
terraform output
```

* Displays all outputs defined in `.tf` files
* Example outputs:

  * `EC2 public_ip = "3.22.45.67"`
  * `instance_id = "i-0abc123456def"`

ğŸ’¡ **Use Case:** Quickly see EC2 instance IP or ID without logging into AWS Console.

---

### ğŸ’£ Step 14: Destroy & State Update ğŸ§¹

When you destroy resources:

```bash
terraform destroy -auto-approve
```

âœ… Terraform updates the state file automatically â€” resources are removed from state.

ğŸ’¡ **Tip:** Always **backup `terraform.tfstate`** before making major changes.

---

### âš¡ Summary Table

| Step | Action            | Command / File           | Result / Use Case                          |
| ---- | ----------------- | ------------------------ | ------------------------------------------ |
| ğŸ¥‡   | Output Values     | `terraform output`       | Get info about resources quickly           |
| ğŸ¥ˆ   | Inspect State     | `terraform show`         | View current infra resources               |
| ğŸ¥‰   | Read File         | `cat terraform.tfstate`  | Understand infra in JSON                   |
| âš™ï¸   | Destroy Resources | `terraform destroy`      | Updates state file to reflect infra status |
| ğŸ’£   | Backup State      | Copy `terraform.tfstate` | Prevent accidental loss or corruption      |

---

âš ï¸ **Notes / Best Practices:**

* Never manually edit `terraform.tfstate`
* Always **backup state file** before destructive changes
* Outputs are **critical for automation** and linking resources

---

âœ… **Next SOP:** **SOP for Remote State (S3, GCS, Terraform Cloud)** â€” advanced team collaboration and state locking.
