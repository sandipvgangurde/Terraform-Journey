# 🧠 **SOP: Multi-Region AWS Provider Configuration in Terraform**

---

## 🌍 **Objective**

This SOP explains how to configure **multiple AWS providers (regions)** in Terraform, assign **aliases**, and map resources (like security groups) to different regions.
It helps you **manage infrastructure in multiple AWS regions** from a single Terraform configuration file. 💪

---

## ⚙️ **Code Overview**

```hcl
provider "aws" {
  region = "ap-southeast-1"
}

provider "aws" {
  alias  = "mumbai"
  region = "ap-south-1"
}

provider "aws" {
  alias  = "usa"
  region = "us-east-1"
}

resource "aws_security_group" "sg_1" {
  name        = "prod_firewall"
  provider    = aws.usa
}

resource "aws_security_group" "sg_2" {
  name        = "staging_firewall"
  provider    = aws.mumbai
}
```

---

## 📚 **Step-by-Step Explanation**

| 🔢 **Step** | 🧩 **Action**                 | 💬 **Description**                                                                           | 🧠 **Example / Purpose**                                              |
| ----------- | ----------------------------- | -------------------------------------------------------------------------------------------- | --------------------------------------------------------------------- |
| 1️⃣         | **Define default provider**   | The first `provider "aws"` block (no alias) defines your *default region* for AWS resources. | `"ap-southeast-1"` → Singapore region 🌏                              |
| 2️⃣         | **Add alias providers**       | Use `alias` to create **additional AWS providers** for other regions.                        | `"aws.mumbai"` for India 🇮🇳 and `"aws.usa"` for USA 🇺🇸            |
| 3️⃣         | **Map provider to resource**  | In each resource, specify the provider using the syntax `provider = aws.<alias>`.            | Example: `provider = aws.usa` assigns the resource to the USA region. |
| 4️⃣         | **Create regional resources** | Each resource block (like a security group) gets deployed **only in its assigned region**.   | `sg_1` → USA, `sg_2` → Mumbai                                         |
| 5️⃣         | **Run Terraform commands**    | Apply the plan to create all resources across multiple regions simultaneously.               | `terraform init → terraform plan → terraform apply` ✅                 |

---

## 🗺️ **Provider-Region Mapping**

| 🌐 **Alias / Provider** | 📍 **Region Name** | 🏷️ **Purpose / Environment** | ⚙️ **Example Resource**   |
| ----------------------- | ------------------ | ----------------------------- | ------------------------- |
| *(Default)*             | `ap-southeast-1`   | Main region (default)         | Optional future resource  |
| `aws.mumbai`            | `ap-south-1`       | Staging / Testing             | `aws_security_group.sg_2` |
| `aws.usa`               | `us-east-1`        | Production                    | `aws_security_group.sg_1` |

---

## 🧩 **Resource Mapping Summary**

| 🔒 **Security Group Name** | 🧭 **Region** | 🔗 **Provider Used** | 🧱 **Environment Purpose**            |
| -------------------------- | ------------- | -------------------- | ------------------------------------- |
| `prod_firewall`            | `us-east-1`   | `aws.usa`            | **Production Firewall Rules**         |
| `staging_firewall`         | `ap-south-1`  | `aws.mumbai`         | **Staging/Test Environment Firewall** |

---

## 🧠 **Key Concepts**

| ⚙️ **Concept**            | 💡 **Meaning / Importance**                                                                     |
| ------------------------- | ----------------------------------------------------------------------------------------------- |
| **Provider**              | Plugin Terraform uses to connect to AWS and manage resources.                                   |
| **Alias**                 | Used to differentiate multiple providers of the same type (e.g., AWS in different regions).     |
| **Provider Reference**    | Each resource must point to its correct provider to ensure it’s created in the intended region. |
| **Default Provider**      | If no alias is given, Terraform uses the first provider block as default.                       |
| **Multi-Region Strategy** | Allows global infrastructure deployment in one codebase (e.g., Mumbai + US).                    |

---

## ⚡ **Use Case Scenarios**

| 🧩 **Use Case**       | 🌍 **Example**                                     | 🎯 **Why It’s Useful**                                |
| --------------------- | -------------------------------------------------- | ----------------------------------------------------- |
| Multi-Region DR Setup | Deploy prod in `us-east-1`, backup in `ap-south-1` | Ensures **high availability** & **disaster recovery** |
| Cost Optimization     | Deploy test infra in cheaper regions               | Save money 💰                                         |
| Compliance / Latency  | Deploy region-specific infra                       | Meet local data regulations 📜                        |
| Environment Isolation | Separate staging & production                      | Avoid interference between environments 🚀            |

---

## 🧾 **Commands to Execute**

| 🧩 **Command**       | 🧰 **Purpose**                                         |
| -------------------- | ------------------------------------------------------ |
| `terraform init`     | Initialize Terraform and download AWS provider plugins |
| `terraform validate` | Verify syntax and configuration correctness            |
| `terraform plan`     | Preview the infrastructure changes                     |
| `terraform apply`    | Deploy the resources to all defined regions            |
| `terraform destroy`  | Clean up the resources from all regions                |

---

## 🚨 **Common Mistakes**

| ⚠️ **Issue**                | 🧨 **Cause**                                        | 🧯 **Fix**                                              |
| --------------------------- | --------------------------------------------------- | ------------------------------------------------------- |
| Error: “Provider not found” | Forgot to reference alias (`provider = aws.mumbai`) | Add correct alias in resource                           |
| Duplicate region conflict   | Used same provider block without alias              | Always add alias for extra regions                      |
| Resources in wrong region   | Didn’t assign provider to resource                  | Always explicitly define provider in multi-region setup |
| Credentials missing         | AWS CLI not configured                              | Run `aws configure` or use environment variables        |

---

## 🏁 **End Result**

After successful execution ✅:

* **Two security groups** will be created —

  * One in **USA (us-east-1)** named `prod_firewall`
  * One in **Mumbai (ap-south-1)** named `staging_firewall`
* Both managed **from the same Terraform configuration** — efficient, clean, and region-aware 🌍⚡

---

## 🧰 **Next Steps (Optional Enhancements)**

| 🚀 **Enhancement**                 | 💡 **Description**                            |
| ---------------------------------- | --------------------------------------------- |
| Add **VPCs** per region            | Deploy custom networks in each region         |
| Add **EC2 Instances**              | Attach instances to region-specific firewalls |
| Use **workspaces**                 | Manage multiple environments cleanly          |
| Integrate with **Terraform Cloud** | Remote state management & collaboration       |

---
