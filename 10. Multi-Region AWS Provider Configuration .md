# ğŸ§  **SOP: Multi-Region AWS Provider Configuration in Terraform**

---

## ğŸŒ **Objective**

This SOP explains how to configure **multiple AWS providers (regions)** in Terraform, assign **aliases**, and map resources (like security groups) to different regions.
It helps you **manage infrastructure in multiple AWS regions** from a single Terraform configuration file. ğŸ’ª

---

## âš™ï¸ **Code Overview**

```hcl
provider "aws" {
  region = "ap-southeast-1"
}

provider "aws" {
  alias  = "mumbai"
  region = "ap-south-1"
}

provider "aws" {
  alias  = "usa"
  region = "us-east-1"
}

resource "aws_security_group" "sg_1" {
  name        = "prod_firewall"
  provider    = aws.usa
}

resource "aws_security_group" "sg_2" {
  name        = "staging_firewall"
  provider    = aws.mumbai
}
```

---

## ğŸ“š **Step-by-Step Explanation**

| ğŸ”¢ **Step** | ğŸ§© **Action**                 | ğŸ’¬ **Description**                                                                           | ğŸ§  **Example / Purpose**                                              |
| ----------- | ----------------------------- | -------------------------------------------------------------------------------------------- | --------------------------------------------------------------------- |
| 1ï¸âƒ£         | **Define default provider**   | The first `provider "aws"` block (no alias) defines your *default region* for AWS resources. | `"ap-southeast-1"` â†’ Singapore region ğŸŒ                              |
| 2ï¸âƒ£         | **Add alias providers**       | Use `alias` to create **additional AWS providers** for other regions.                        | `"aws.mumbai"` for India ğŸ‡®ğŸ‡³ and `"aws.usa"` for USA ğŸ‡ºğŸ‡¸            |
| 3ï¸âƒ£         | **Map provider to resource**  | In each resource, specify the provider using the syntax `provider = aws.<alias>`.            | Example: `provider = aws.usa` assigns the resource to the USA region. |
| 4ï¸âƒ£         | **Create regional resources** | Each resource block (like a security group) gets deployed **only in its assigned region**.   | `sg_1` â†’ USA, `sg_2` â†’ Mumbai                                         |
| 5ï¸âƒ£         | **Run Terraform commands**    | Apply the plan to create all resources across multiple regions simultaneously.               | `terraform init â†’ terraform plan â†’ terraform apply` âœ…                 |

---

## ğŸ—ºï¸ **Provider-Region Mapping**

| ğŸŒ **Alias / Provider** | ğŸ“ **Region Name** | ğŸ·ï¸ **Purpose / Environment** | âš™ï¸ **Example Resource**   |
| ----------------------- | ------------------ | ----------------------------- | ------------------------- |
| *(Default)*             | `ap-southeast-1`   | Main region (default)         | Optional future resource  |
| `aws.mumbai`            | `ap-south-1`       | Staging / Testing             | `aws_security_group.sg_2` |
| `aws.usa`               | `us-east-1`        | Production                    | `aws_security_group.sg_1` |

---

## ğŸ§© **Resource Mapping Summary**

| ğŸ”’ **Security Group Name** | ğŸ§­ **Region** | ğŸ”— **Provider Used** | ğŸ§± **Environment Purpose**            |
| -------------------------- | ------------- | -------------------- | ------------------------------------- |
| `prod_firewall`            | `us-east-1`   | `aws.usa`            | **Production Firewall Rules**         |
| `staging_firewall`         | `ap-south-1`  | `aws.mumbai`         | **Staging/Test Environment Firewall** |

---

## ğŸ§  **Key Concepts**

| âš™ï¸ **Concept**            | ğŸ’¡ **Meaning / Importance**                                                                     |
| ------------------------- | ----------------------------------------------------------------------------------------------- |
| **Provider**              | Plugin Terraform uses to connect to AWS and manage resources.                                   |
| **Alias**                 | Used to differentiate multiple providers of the same type (e.g., AWS in different regions).     |
| **Provider Reference**    | Each resource must point to its correct provider to ensure itâ€™s created in the intended region. |
| **Default Provider**      | If no alias is given, Terraform uses the first provider block as default.                       |
| **Multi-Region Strategy** | Allows global infrastructure deployment in one codebase (e.g., Mumbai + US).                    |

---

## âš¡ **Use Case Scenarios**

| ğŸ§© **Use Case**       | ğŸŒ **Example**                                     | ğŸ¯ **Why Itâ€™s Useful**                                |
| --------------------- | -------------------------------------------------- | ----------------------------------------------------- |
| Multi-Region DR Setup | Deploy prod in `us-east-1`, backup in `ap-south-1` | Ensures **high availability** & **disaster recovery** |
| Cost Optimization     | Deploy test infra in cheaper regions               | Save money ğŸ’°                                         |
| Compliance / Latency  | Deploy region-specific infra                       | Meet local data regulations ğŸ“œ                        |
| Environment Isolation | Separate staging & production                      | Avoid interference between environments ğŸš€            |

---

## ğŸ§¾ **Commands to Execute**

| ğŸ§© **Command**       | ğŸ§° **Purpose**                                         |
| -------------------- | ------------------------------------------------------ |
| `terraform init`     | Initialize Terraform and download AWS provider plugins |
| `terraform validate` | Verify syntax and configuration correctness            |
| `terraform plan`     | Preview the infrastructure changes                     |
| `terraform apply`    | Deploy the resources to all defined regions            |
| `terraform destroy`  | Clean up the resources from all regions                |

---

## ğŸš¨ **Common Mistakes**

| âš ï¸ **Issue**                | ğŸ§¨ **Cause**                                        | ğŸ§¯ **Fix**                                              |
| --------------------------- | --------------------------------------------------- | ------------------------------------------------------- |
| Error: â€œProvider not foundâ€ | Forgot to reference alias (`provider = aws.mumbai`) | Add correct alias in resource                           |
| Duplicate region conflict   | Used same provider block without alias              | Always add alias for extra regions                      |
| Resources in wrong region   | Didnâ€™t assign provider to resource                  | Always explicitly define provider in multi-region setup |
| Credentials missing         | AWS CLI not configured                              | Run `aws configure` or use environment variables        |

---

## ğŸ **End Result**

After successful execution âœ…:

* **Two security groups** will be created â€”

  * One in **USA (us-east-1)** named `prod_firewall`
  * One in **Mumbai (ap-south-1)** named `staging_firewall`
* Both managed **from the same Terraform configuration** â€” efficient, clean, and region-aware ğŸŒâš¡

---

## ğŸ§° **Next Steps (Optional Enhancements)**

| ğŸš€ **Enhancement**                 | ğŸ’¡ **Description**                            |
| ---------------------------------- | --------------------------------------------- |
| Add **VPCs** per region            | Deploy custom networks in each region         |
| Add **EC2 Instances**              | Attach instances to region-specific firewalls |
| Use **workspaces**                 | Manage multiple environments cleanly          |
| Integrate with **Terraform Cloud** | Remote state management & collaboration       |

---
