# ğŸ§© **SOP: Terraform + AWS EC2 Setup (Secure Auth & AWS CLI Management)** ğŸ’»â˜ï¸

---

## ğŸ¯ **Goal**

By the end of this SOP, youâ€™ll:

âœ… Authenticate AWS using **environment variables** or **AWS CLI configure**
âœ… Create **one EC2 instance** using Terraform
âœ… Learn best practices â€” **no hardcoding credentials**
âœ… Manage or remove AWS CLI configurations safely

---

## ğŸªœ **Step-by-Step Guide**

---

### ğŸ¥‡ Step 1: Authenticate AWS ğŸ”

#### **Option 1: Using Environment Variables**

```bash
export AWS_ACCESS_KEY_ID="your_access_key"
export AWS_SECRET_ACCESS_KEY="your_secret_key"
export AWS_DEFAULT_REGION="ap-south-1"
```

âœ… **Verify:**

```bash
echo $AWS_ACCESS_KEY_ID
echo $AWS_SECRET_ACCESS_KEY
echo $AWS_DEFAULT_REGION
```

ğŸ’¡ **Use Case:**
Terraform reads these automatically. Safer than putting keys in code.

---

#### **Option 2: Using AWS CLI Configure**

```bash
aws configure
```

Then input:

```
AWS Access Key ID [None]: your_access_key
AWS Secret Access Key [None]: your_secret_key
Default region name [None]: ap-south-1
Default output format [None]: json
```

âœ… **Verify:**

```bash
aws sts get-caller-identity
```

> Output shows your AWS account ID and ARN â€” confirms authentication works.

ğŸ’¡ **Use Case:** Terraform picks credentials from `~/.aws/credentials`. Common in DevOps workflows.

---

### ğŸ¥ˆ Step 2: Create Terraform Project Folder ğŸ“

```bash
mkdir terraform-ec2-simple
cd terraform-ec2-simple
```

ğŸ’¡ **Use Case:** Keeps Terraform workspace organized.

---

### ğŸ¥‰ Step 3: Create `provider.tf` ğŸ”‘

```hcl
provider "aws" {
  region = var.aws_region
}
```

ğŸ’¡ Terraform automatically uses environment variables **or** AWS CLI config.

---

### ğŸ—ï¸ Step 4: Create `variables.tf` ğŸŒ±

```hcl
variable "aws_region" {
  description = "AWS Region to deploy EC2"
  default     = "us-east-1"
}
```

ğŸ’¡ **Use Case:** Centralizes region configuration.

---

### ğŸ–¥ï¸ Step 5: Create EC2 Instance `ec2.tf` âš¡

```hcl
resource "aws_instance" "myec2" {
    ami="ami-0341d95f75f311023"
    instance_type="t3.micro"
}
output "instance_id" {
  value = aws_instance.myec2.id
}

output "public_ip" {
  value = aws_instance.myec2.public_ip
}
```

ğŸ’¡ **Use Case:** Deploys one EC2 instance automatically and shows **Instance ID & Public IP**.

---

### âš™ï¸ Step 6: Initialize Terraform ğŸ§ 

```bash
terraform init
```

âœ… Downloads AWS provider and prepares Terraform.

---

### ğŸ” Step 7: Plan Deployment ğŸ“

```bash
terraform plan
```

âœ… Preview changes before applying.

---

### ğŸš€ Step 8: Apply Configuration ğŸ–¥ï¸

```bash
terraform apply -auto-approve
```

âœ… Creates EC2 instance automatically in AWS account.

---

### ğŸ‘€ Step 9: Verify in AWS Console ğŸ”

* Go to **EC2 â†’ Instances**
* Check instance named **Terraform-EC2-Simple**

---

### ğŸ’£ Step 10: Destroy Resources When Done ğŸ§¹

```bash
terraform destroy -auto-approve
```

âœ… Cleans up AWS to avoid charges ğŸ’°

---

### ğŸ—‘ï¸ Step 11: Remove or Manage AWS CLI Config (Linux) ğŸ§¹

#### 1ï¸âƒ£ Default CLI config location

* **Linux/macOS:** `~/.aws/`
* **Windows:** `C:\Users\<username>\.aws\`

Contains:

* `credentials` â†’ stores Access Key & Secret Key
* `config` â†’ stores default region and output format

---

#### 2ï¸âƒ£ Remove all CLI configs

```bash
rm -rf ~/.aws
```

> Completely removes all saved profiles, keys, and default region/output.

---

#### 3ï¸âƒ£ Remove a specific profile (optional)

```bash
nano ~/.aws/credentials
nano ~/.aws/config
```

Delete only the profile you want to remove.

---

#### 4ï¸âƒ£ Remove via CLI

```bash
aws configure
# Press Enter for each prompt to leave blank
```

> This unsets default credentials safely.

âš ï¸ **Warning:** Deleting `.aws` will break scripts or CLI commands depending on AWS credentials.

---

## ğŸ§© **Summary Table**

| Step | Action                | Command / File                    | Result / Use Case                         |
| ---- | --------------------- | --------------------------------- | ----------------------------------------- |
| ğŸ¥‡   | AWS Auth              | Env variables / `aws configure`   | Secure authentication                     |
| ğŸ¥ˆ   | Project Folder        | `mkdir terraform-ec2-simple`      | Workspace ready                           |
| ğŸ¥‰   | Provider              | `provider.tf`                     | Terraform picks credentials automatically |
| ğŸ—ï¸  | Variables             | `variables.tf`                    | Centralized region config                 |
| ğŸ–¥ï¸  | EC2 Instance + Output | `ec2.tf`                          | Single EC2 deployed with outputs          |
| âš™ï¸   | Init                  | `terraform init`                  | Terraform ready                           |
| ğŸ”   | Plan                  | `terraform plan`                  | Preview deployment                        |
| ğŸš€   | Apply                 | `terraform apply`                 | EC2 created                               |
| ğŸ‘€   | Verify                | AWS Console                       | Confirm deployment                        |
| ğŸ’£   | Destroy               | `terraform destroy`               | Cleanup AWS                               |
| ğŸ—‘ï¸  | Remove CLI config     | `rm -rf ~/.aws` / `aws configure` | Remove or reset credentials safely        |

---

âš¡ **Notes & Tips:**

* **Do not hardcode keys** â€” environment variables or CLI config are best practice.
* Outputs let you **reuse instance info** in scripts.
* Always destroy resources to **avoid unwanted charges**.

---

